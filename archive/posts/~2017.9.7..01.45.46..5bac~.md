---
type: post
date: ~2017.9.7..01.45.46..5bac
title: PKI musings
author: ~barpub-tarber
navsort: bump
navuptwo: true
comments: reverse
---

This is an extension of a chat from meta last night, [~ravmel-ropdyl](https://ravmel-ropdyl.urbit.org) suggested making a thread from it.

The [urbit roadmap](https://urbit.org/blog/2017.5-plans/) post talks a bit about plans for the public-key infrastructure, quote: "The current options: physical delivery of tamper-resistant artifacts, or registering ownership on Ethereum or another blockchain."

Now, the plans to tokenize the next crowdsale of galaxies and stars were announced at the last SF meetup, and these are exciting plans. The roadmap post also has this: "An offline key can block all transfers", which seems like it's pointing in the direction this post will discuss, but I have no special insight into what's actually cooking at Tlon HQ. I suspect the essence of this is on the roadmap already, but it still bears discussion.

I would like ownership of an urbit to have certain properties, namely: the master key is generated by the user, the urbit operates without the master key being present on the server/localhost, and the master private key may be regenerated from data which is completely offline. I should be able to put my keys in my will, with good confidence that my heirs can reclaim ownership of the address if not the urbits themselves. 

This implies a split between 'owner' and 'operator' keys, where the operator key lives on the urbit itself and provides authentication and decryption for the running urbit process, while the owner key can be used to update the operator key, invalidating the old one in the process, as well as sign the deed to transfer the address to a new owner. 

I would like to be able to keep the owner key on a [hardware wallet](https://twitter.com/djinnius/status/905347339740626944); that, and the requirement to be able to regenerate it from offline data, imply the use of [bip39](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki) to store the entropy for the owner key in a way that's compatible with the existing hardware wallets. While we could use an `@p` string, and in general that strikes me as more Urbitesque, in this particular instance staying compatible with existing hardware selects against that. 

This distinction between the urbit and its owner would give confidence that pwnage of the server running the urbit can't lead to losing the address, which is at minimum someone's personal identity, and sometimes is a critical piece of network infrastructure which others will rely upon. 

This could allow a few levels of security, depending on requirements. At the simplest level, the owner key isn't needed except to invalidate the operator key and sign over the deed for the address. A level above that, the urbit won't start without signing a challenge string with the master key. 

Above that, turning off the urbit process destroys the operator key, which is always and only kept in memory, with the whole of clay and the event log being encrypted with the operator key.  How does one recover from this? You keep a plaintext string, and use the owner-key signature of that plaintext string as the entropy to regenerate the operator key. The only legible contents of the ship's directory would be that string, which is useless on its own. 

There are some unanswered questions here surrounding on-boarding and the like, but that's the basic outline. 


