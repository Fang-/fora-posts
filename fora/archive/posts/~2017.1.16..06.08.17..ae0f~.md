---
type: post
date: ~2017.1.16..06.08.17..ae0f
title: A Proposal For Doccords
author: ~ponnys-podfer
navsort: bump
navuptwo: true
comments: reverse
---

## The Vision

The biggest problem with the entire Urbit ecosystem is its scattered documentation. The Urbit documentation website is terminally slow, unlike a terminal which is terminally fast.

Wouldn't it be great if, from the `dojo`, you could do the following?

    > /+  string
    > # string
    String processing library

    When we refer to a "string", we mean a tape unless otherwise is specified.

    Arms:
      ++contains
      ++sum
    [...]
    > # sum:string
    Sum of the values of the strings characters.
    >

## How Do Other Languages Do It?

Are there other languages which have in-repl documentation? Yes. They have _docstrings_ which are embedded in the code. Lisp docstrings in action look like this:

    (defun set-right-margin (from to width)
      "Set the right margin of the region to WIDTH.
    If `auto-fill-mode' is active, re-fill the region to fit the new margin.

    Interactively, WIDTH is the prefix argument, if specified.
    Without prefix argument, the command prompts for WIDTH."
      (interactive "r\nNSet right margin to width: ")
      [...])

And Python docstrings looks like this:

    def split(pattern, string, maxsplit=0, flags=0):
        """Split the source string by the occurrences of the pattern,
        returning a list containing the resulting substrings."""
        return _compile(pattern, flags).split(string, maxsplit)

Hoon doesn't have _strings_, it has _cords_, so let's make a first shot at adding _doccords_ to `~palfun`'s new string library:

    ^:  '''
        String processing library

        When we refer to a "string", we mean a tape unless otherwise is specified.
        '''
    |%
    ::
    ++  contains
      ^:  'Returns whether the second argument is contained in the first.'
      |=  {str/tape nedl/tape}
      ^-  ?
      ?~  (find nedl str)  |  &
    ::
    ++  sum
      ^:  'Sum of the values of the strings characters.'
      |=  str/tape
      ^-  @ud
      =|  sm/@ud
      |-
      ?~  str  sm
      $(sm (add sm i.str), str t.str)
    [...]
    --

## The Implementation

The Vision is actually implemented! Poorly! The output at the beginning of this article was from a fakezod I have with these patches. This is a mere prototype and has a long way to go before I have something commitable, but for those who want to check out the code:

    https://github.com/eglaysher/arvo/tree/doccords-as-span
    https://github.com/eglaysher/urbit/tree/doccords-as-span

This prototype works by adding a new `++twig` `{$help p/cord q/twig}` / `^:` which creates a new `++span` `{$docs p/cord q/span}` which contains a _doccord_. Those changes to `sys/hoon.hoon` might be fine, but the current implementation in `app/dojo.hoon` is barely working prototype code. I have added a `# wing` command to dojo to surface a `$help` or `$docs` depending on what's available contextually.

(Why use `#` as a marker for help? Lines couldn't previously start with `#`, so I wouldn't be conflicting with existing syntax.)

## Where To Go From Here

- First of all, I suspect my implementation in dojo just needs to be redone from scratch. I'm piggybacking off of the current `??` command and then inspecting the span, which is almost always a `[%hold <|core|> twig-tree]`. Even though my changes to hoon add the doccord to the `++span`, the dojo implementation almost always fishes it out of the `++twig` tree instead. This is the biggest issue with the patch.

    How _should_ I go about doing this?

- The current implementation can list arms on a core, but it doesn't pull additional documentation about types out of arm documentation. In the `# sum:string` example above, it would be really nice if I could also print out automatically that `sum:string` is a `$-(tape @ud)`. This seems like the sort of thing that should be done with a twig tree as human readable documentation would probably want to leave molds like `(list tape)` instead of a span like `*""` which can be arbitrarily ugly. But I don't believe that this information is available in the `++span`.

- Because I'm piggybacking on the existing `??` command, I don't know how I'd get a nice header like `++sum:string` as the first line in the output. (This is merely a nice-to-have, but I do think that would make the output nicer.)

- `~sorreg` advised me to try to modify `++foot` instead and put the doccords there. I made a prototype based on that, but I want doccords in more contexts than just on arms; there should be toplevel documentation on entire cores.

- This is probably a good candidate for some irregular syntax. Instead of:

        ++  arm
        ^:  'doccord'
        |=  a/*

    It would be nice to be able to drop the sigil:
    
        ++  arm
        'doccord'
        |=  a/*

- The current implementation should produce some sort of toplevel documentation autogenerated from the current subject in case of an empty `#`. Something like:

        > #
        Hoon Help
        
          +15: 1a: unsigned arithmetic
          +7:  2a: unit logic
          +3:  2b: list logic
          [...]
        
        Loaded Libraries
        
          ++string: String processing library
          
        >
        
    This is entirely unimplemented. Perhaps it is not possible. The axis above are obviously wrong, but it gets the idea across. Issues abound here! What am I missing?

- In Emacs, you can rely on docstrings existing for any function you'd try to call interactively because there's a culture of expectation on the programmer to provide them. I think adding doccords is valuable, but only if there's follow through with peer pressure so Thou Shalt Document Code.